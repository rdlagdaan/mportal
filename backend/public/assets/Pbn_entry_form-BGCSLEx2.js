import{j as e,n as r}from"./index-Db0C4r-3.js";import{r as a,H as O}from"./handsontable-BULuqGHq.js";import"./react-Csw2ODfV.js";function A(){const[w,D]=a.useState([]),[k,P]=a.useState([]),[u,T]=a.useState([]),[b,x]=a.useState(""),[g,y]=a.useState(""),[v,j]=a.useState(""),[N,f]=a.useState(""),[o,S]=a.useState(""),[C,_]=a.useState(""),c=a.useRef(null);a.useEffect(()=>{(async()=>{const[n,l,s,d]=await Promise.all([r.get("/api/sugar-types"),r.get("/api/crop-years"),r.get("/api/vendors"),r.get("/api/settings/PBNNO")]);D(n.data),P(l.data),T(s.data),x(d.data.value)})()},[]),a.useEffect(()=>{const t=u.find(n=>n.vend_code===o);_(t?.vend_name||"")},[o,u]);const E=()=>{j(""),f(""),S(""),_(""),y(new Date().toISOString().substring(0,10)),x(""),c.current?.hotInstance?.loadData([{}])},H=async()=>{const t=c.current?.hotInstance;if(!t)return;const n=t.getData().map(s=>{const[d,p,i,I]=s,m=parseFloat(i)||0,h=parseFloat(I)||0;return{mill:p||"",quantity:m,commission:h,cost:m*h,total_cost:m*h}}),l={pbn_number:b,pbn_date:g,sugar_type:v,crop_year:N,vend_code:o,vendor_name:C,details:n};try{await r.post("/api/pbn-entry",l),alert("Saved successfully")}catch(s){console.error(s),alert("Save failed")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Sugar Type"}),e.jsxs("select",{value:v,onChange:t=>j(t.target.value),className:"w-full border p-2",children:[e.jsx("option",{value:"",children:"Select"}),w.map(t=>e.jsx("option",{value:t.sugar_type,children:t.sugar_type},t.sugar_type))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"PBN Number"}),e.jsx("input",{value:b,disabled:!0,className:"w-full border p-2 bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"PBN Date"}),e.jsx("input",{type:"date",value:g,onChange:t=>y(t.target.value),className:"w-full border p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Crop Year"}),e.jsxs("select",{value:N,onChange:t=>f(t.target.value),className:"w-full border p-2",children:[e.jsx("option",{value:"",children:"Select"}),k.map(t=>e.jsx("option",{value:t.crop_year,children:t.crop_year},t.crop_year))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Vendor Code"}),e.jsxs("select",{value:o,onChange:t=>S(t.target.value),className:"w-full border p-2",children:[e.jsx("option",{value:"",children:"Select"}),u.map(t=>e.jsx("option",{value:t.vend_code,children:t.vend_code},t.vend_code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Vendor Name"}),e.jsx("input",{value:C,disabled:!0,className:"w-full border p-2 bg-gray-100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold mb-2",children:"Details"}),e.jsx(O,{ref:c,data:[{}],colHeaders:["#","Mill","Quantity","Commission","Cost","Total Cost"],columns:[{readOnly:!0},{type:"text"},{type:"numeric"},{type:"numeric"},{readOnly:!0},{readOnly:!0}],licenseKey:"non-commercial-and-evaluation",stretchH:"all",height:"auto",width:"100%",rowHeaders:!0,afterChange:(t,n)=>{n==="edit"&&t&&t.forEach(([l])=>{const s=c.current?.hotInstance;if(!s)return;const d=parseFloat(s.getDataAtCell(l,2))||0,p=parseFloat(s.getDataAtCell(l,3))||0,i=d*p;s.setDataAtCell(l,4,i),s.setDataAtCell(l,5,i)})}})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:E,className:"bg-gray-300 px-4 py-2 rounded",children:"New"}),e.jsx("button",{onClick:H,className:"bg-green-500 text-white px-4 py-2 rounded",children:"Save"}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Print"}),e.jsx("button",{className:"bg-yellow-500 text-white px-4 py-2 rounded",children:"Download"})]})]})}export{A as default};
