import{j as e,n as r}from"./index-CyubHGcg.js";import{r as t,H as O,a as V,N as Y}from"./handsontable-Ct7q-QUQ.js";import"./react-Csw2ODfV.js";V.cellTypes.registerCellType("numeric",Y);function F(){const[w,D]=t.useState([]),[k,P]=t.useState([]),[u,T]=t.useState([]),[b,x]=t.useState(""),[g,v]=t.useState(""),[y,j]=t.useState(""),[N,f]=t.useState(""),[o,C]=t.useState(""),[S,_]=t.useState(""),c=t.useRef(null);t.useEffect(()=>{(async()=>{const[n,l,s,d]=await Promise.all([r.get("/api/sugar-types"),r.get("/api/crop-years"),r.get("/api/vendors"),r.get("/api/settings/PBNNO")]);D(n.data),P(l.data),T(s.data),x(d.data.value)})()},[]),t.useEffect(()=>{const a=u.find(n=>n.vend_code===o);_(a?.vend_name||"")},[o,u]);const H=()=>{j(""),f(""),C(""),_(""),v(new Date().toISOString().substring(0,10)),x(""),c.current?.hotInstance?.loadData([{}])},E=async()=>{const a=c.current?.hotInstance;if(!a)return;const n=a.getData().map(s=>{const[d,p,i,I]=s,m=parseFloat(i)||0,h=parseFloat(I)||0;return{mill:p||"",quantity:m,commission:h,cost:m*h,total_cost:m*h}}),l={pbn_number:b,pbn_date:g,sugar_type:y,crop_year:N,vend_code:o,vendor_name:S,details:n};try{await r.post("/api/pbn-entry",l),alert("Saved successfully")}catch(s){console.error(s),alert("Save failed")}};return e.jsxs("div",{className:"space-y-6 w-full px-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Sugar Type"}),e.jsxs("select",{value:y,onChange:a=>j(a.target.value),className:"w-full border p-2",children:[e.jsx("option",{value:"",children:"Select"}),w.map(a=>e.jsxs("option",{value:a.id,children:[a.sugar_type," - ",a.description]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"PBN Number"}),e.jsx("input",{value:b,disabled:!0,className:"w-full border p-2 bg-gray-100"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"PBN Date"}),e.jsx("input",{type:"date",value:g,onChange:a=>v(a.target.value),className:"w-full border p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Crop Year"}),e.jsxs("select",{value:N,onChange:a=>f(a.target.value),className:"w-full border p-2",children:[e.jsx("option",{value:"",children:"Select"}),k.map(a=>e.jsx("option",{value:a.crop_year,children:a.crop_year},a.crop_year))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Vendor Code"}),e.jsxs("select",{value:o,onChange:a=>C(a.target.value),className:"w-full border p-2",children:[e.jsx("option",{value:"",children:"Select"}),u.map(a=>e.jsx("option",{value:a.vend_code,children:a.vend_code},a.vend_code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Vendor Name"}),e.jsx("input",{value:S,disabled:!0,className:"w-full border p-2 bg-gray-100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-bold mb-2",children:"Details"}),e.jsx(O,{ref:c,data:[{}],colHeaders:["#","Mill","Quantity","Commission","Cost","Total Cost"],columns:[{readOnly:!0},{type:"text"},{type:"numeric"},{type:"numeric"},{readOnly:!0},{readOnly:!0}],licenseKey:"non-commercial-and-evaluation",stretchH:"all",height:"auto",width:"100%",rowHeaders:!0,afterChange:(a,n)=>{n==="edit"&&a&&a.forEach(([l])=>{const s=c.current?.hotInstance;if(!s)return;const d=parseFloat(s.getDataAtCell(l,2))||0,p=parseFloat(s.getDataAtCell(l,3))||0,i=d*p;s.setDataAtCell(l,4,i),s.setDataAtCell(l,5,i)})}})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:H,className:"bg-gray-300 px-4 py-2 rounded",children:"New"}),e.jsx("button",{onClick:E,className:"bg-green-500 text-white px-4 py-2 rounded",children:"Save"}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Print"}),e.jsx("button",{className:"bg-yellow-500 text-white px-4 py-2 rounded",children:"Download"})]})]})}export{F as default};
