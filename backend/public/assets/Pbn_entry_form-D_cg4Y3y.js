import{j as t,n as o}from"./index-CIkmRSX3.js";import{r as a,H as R,a as $,N as K}from"./handsontable-Ct7q-QUQ.js";import"./react-Csw2ODfV.js";$.cellTypes.registerCellType("numeric",K);function G(){const[w,k]=a.useState([]),[D,E]=a.useState([]),[p,F]=a.useState([]),[T,f]=a.useState(""),[N,u]=a.useState(""),[_,h]=a.useState(""),[S,m]=a.useState(""),[r,b]=a.useState(""),[C,g]=a.useState(""),c=a.useRef(null),B=1,[x,H]=a.useState(!1),[P,I]=a.useState([]),[O,V]=a.useState("");a.useEffect(()=>{(async()=>{const[s,l,n,d]=await Promise.all([o.get("/api/sugar-types"),o.get("/api/crop-years"),o.get("/api/vendors"),o.get(`/api/settings/PBNNO?company_id=${B}`)]);k(s.data),console.log(s),E(l.data),F(n.data),f(d.data.value)})()},[]),a.useEffect(()=>{const e=p.find(s=>s.vend_code===r);g(e?.vend_name||"")},[r,p]),a.useEffect(()=>{(async()=>{try{const s=await o.get(`/api/pbn-entries?postedFlag=${x?1:0}`);I(s.data)}catch(s){console.error("Failed to fetch PBN entries",s)}})()},[x]);const Y=()=>{h(""),m(""),b(""),g(""),u(new Date().toISOString().substring(0,10)),f(""),c.current?.hotInstance?.loadData([{}])},q=async()=>{const e=c.current?.hotInstance;if(!e)return;const s=e.getData().map(n=>{const[d,v,i,A]=n,y=parseFloat(i)||0,j=parseFloat(A)||0;return{mill:v||"",quantity:y,commission:j,cost:y*j,total_cost:y*j}}),l={pbn_number:T,pbn_date:N,sugar_type:_,crop_year:S,vend_code:r,vendor_name:C,details:s};try{await o.post("/api/pbn-entry",l),alert("Saved successfully")}catch(n){console.error(n),alert("Save failed")}};return t.jsxs("div",{className:"w-full h-full px-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block",children:"Sugar Type"}),t.jsxs("select",{value:_,onChange:e=>h(e.target.value),className:"w-full border p-2",children:[t.jsx("option",{value:"",children:"Select"}),w.map(e=>t.jsxs("option",{value:e.id,children:[e.sugar_type," - ",e.description]},e.id))]})]}),t.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[t.jsx("input",{type:"checkbox",id:"chkPbnPosted",checked:x,onChange:e=>H(e.target.checked)}),t.jsx("label",{htmlFor:"chkPbnPosted",children:"PBN #:"}),t.jsxs("select",{value:O,onChange:e=>{const s=P.find(l=>l.pbn_number===e.target.value);V(e.target.value),s&&(h(s.sugar_type),m(s.crop_year),b(s.vend_code),g(s.vendor_name),u(s.pbn_date))},className:"border p-2 w-[550px] bg-yellow-100",children:[t.jsx("option",{value:"",children:"Select PBN Number"}),P.map(e=>t.jsxs("option",{value:e.pbn_number,children:[e.pbn_number," | ",e.sugar_type," | ",e.vend_code," | ",e.vendor_name," | ",e.crop_year," | ",e.pbn_date]},e.pbn_number))]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block",children:"PBN Date"}),t.jsx("input",{type:"date",value:N,onChange:e=>u(e.target.value),className:"w-full border p-2"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block",children:"Crop Year"}),t.jsxs("select",{value:S,onChange:e=>m(e.target.value),className:"w-full border p-2",children:[t.jsx("option",{value:"",children:"Select"}),D.map(e=>t.jsx("option",{value:e.crop_year,children:e.crop_year},e.crop_year))]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block",children:"Vendor Code"}),t.jsxs("select",{value:r,onChange:e=>b(e.target.value),className:"w-full border p-2",children:[t.jsx("option",{value:"",children:"Select"}),p.map(e=>t.jsx("option",{value:e.vend_code,children:e.vend_code},e.vend_code))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block",children:"Vendor Name"}),t.jsx("input",{value:C,disabled:!0,className:"w-full border p-2 bg-gray-100"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block font-bold mb-2",children:"Details"}),t.jsx(R,{ref:c,data:[{}],colHeaders:["#","Mill","Quantity","Commission","Cost","Total Cost"],columns:[{readOnly:!0},{type:"text"},{type:"numeric"},{type:"numeric"},{readOnly:!0},{readOnly:!0}],licenseKey:"non-commercial-and-evaluation",stretchH:"all",height:"auto",width:"100%",rowHeaders:!0,afterChange:(e,s)=>{s==="edit"&&e&&e.forEach(([l])=>{const n=c.current?.hotInstance;if(!n)return;const d=parseFloat(n.getDataAtCell(l,2))||0,v=parseFloat(n.getDataAtCell(l,3))||0,i=d*v;n.setDataAtCell(l,4,i),n.setDataAtCell(l,5,i)})}})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("button",{onClick:Y,className:"bg-gray-300 px-4 py-2 rounded",children:"New"}),t.jsx("button",{onClick:q,className:"bg-green-500 text-white px-4 py-2 rounded",children:"Save"}),t.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Print"}),t.jsx("button",{className:"bg-yellow-500 text-white px-4 py-2 rounded",children:"Download"})]})]})}export{G as default};
