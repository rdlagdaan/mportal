import{n as i,j as e,F as ae,a as g}from"./index-DXqvPpF9.js";import{r as l}from"./handsontable-B9UYrM3w.js";import{F as te,a as le,b as re,c as D}from"./csrf-BXg6UNMB.js";import"./react-DJG_os-6.js";const F=[{value:"straight_line",label:"Straight Line"},{value:"declining_balance",label:"Declining Balance"},{value:"units_of_production",label:"Units of Production"},{value:"none",label:"None"}];function oe(){const[t,U]=l.useState("class"),[n,I]=l.useState(null),[j,A]=l.useState(null),[L,q]=l.useState(!1),[w,Y]=l.useState(10),[d,T]=l.useState(1),[S,R]=l.useState(1),[E,G]=l.useState(""),[O,Q]=l.useState(""),[f,z]=l.useState("code"),C=l.useRef(null),[N,B]=l.useState([]),[v,H]=l.useState([]),[K,J]=l.useState([]),[V,X]=l.useState(!1),[b,P]=l.useState("add"),[p,$]=l.useState(null),[x,u]=l.useState({class_code:"",class_name:"",default_life_months:60,default_depr_method:"straight_line",residual_rate:0,is_active:!0,sort_order:0}),[_,y]=l.useState({class_id:void 0,cat_code:"",cat_name:"",is_active:!0,sort_order:0}),[o,m]=l.useState({category_id:void 0,type_code:"",type_name:"",life_months_override:void 0,depr_method_override:void 0,residual_rate_override:void 0,is_active:!0,sort_order:0});l.useEffect(()=>{(async()=>{try{const a=await i.get("/settings/paginaterecs");Y(Number(a.data?.value)||10)}catch{}await h(1,t,O)})()},[]),l.useEffect(()=>(C.current&&clearTimeout(C.current),C.current=setTimeout(()=>Q(E),300),()=>{C.current&&clearTimeout(C.current)}),[E]),l.useEffect(()=>{h(1,t,O)},[O,t,f,n?.id,j?.id]);async function h(s=1,a=t,r=""){q(!0);try{if(a==="class"){const c=await i.get("/assets/classes",{params:{per_page:w,page:s,q:r,order:f==="recent"?"recent":"class_code"}});B(c.data.data),T(c.data.current_page),R(c.data.last_page)}else if(a==="category"){const c=await i.get("/assets/categories",{params:{per_page:w,page:s,q:r,order:f==="recent"?"recent":"cat_code",class_id:n?.id}});H(c.data.data),T(c.data.current_page),R(c.data.last_page)}else{const c=await i.get("/assets/types",{params:{per_page:w,page:s,q:r,order:f==="recent"?"recent":"type_code",category_id:j?.id}});J(c.data.data),T(c.data.current_page),R(c.data.last_page)}}finally{q(!1)}}function W(){P("add"),$(null),t==="class"&&u({class_code:"",class_name:"",default_life_months:60,default_depr_method:"straight_line",residual_rate:0,is_active:!0,sort_order:0}),t==="category"&&y({class_id:n?.id,cat_code:"",cat_name:"",is_active:!0,sort_order:0}),t==="type"&&m({category_id:j?.id,type_code:"",type_name:"",is_active:!0,sort_order:0}),X(!0)}function Z(s){P("edit"),$(s.id),t==="class"&&u({...s}),t==="category"&&y({...s}),t==="type"&&m({...s}),X(!0)}function k(){X(!1)}async function ee(s){s.preventDefault(),await D("lrwsis");try{if(t==="class"){const a=x;b==="edit"&&p?await i.patch(`/assets/classes/${p}`,a,{headers:{"X-XSRF-TOKEN":g.get("XSRF-TOKEN")||""},withCredentials:!0}):await i.post("/assets/classes",a,{headers:{"X-XSRF-TOKEN":g.get("XSRF-TOKEN")||""},withCredentials:!0})}else if(t==="category"){const a={..._,class_id:_.class_id??n?.id};if(!a.class_id){alert("Select a Class first.");return}b==="edit"&&p?await i.patch(`/assets/categories/${p}`,a,{headers:{"X-XSRF-TOKEN":g.get("XSRF-TOKEN")||""},withCredentials:!0}):await i.post("/assets/categories",a,{headers:{"X-XSRF-TOKEN":g.get("XSRF-TOKEN")||""},withCredentials:!0})}else{const a={...o,category_id:o.category_id??j?.id};if(!a.category_id){alert("Select a Category first.");return}b==="edit"&&p?await i.patch(`/assets/types/${p}`,a,{headers:{"X-XSRF-TOKEN":g.get("XSRF-TOKEN")||""},withCredentials:!0}):await i.post("/assets/types",a,{headers:{"X-XSRF-TOKEN":g.get("XSRF-TOKEN")||""},withCredentials:!0})}k(),await h(d)}catch(a){alert(a?.response?.data?.message||"Save failed")}}async function se(s){if(!confirm("Delete this record?"))return;await D("lrwsis");const a={class:"/assets/classes",category:"/assets/categories",type:"/assets/types"};await i.delete(`${a[t]}/${s}`,{headers:{"X-XSRF-TOKEN":g.get("XSRF-TOKEN")||""},withCredentials:!0});const r=(t==="class"?N:t==="category"?v:K).length===1&&d>1?d-1:d;await h(r)}const M=t==="class"?N:t==="category"?v:K;return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-full",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:["class","category","type"].map(s=>e.jsx("button",{onClick:()=>U(s),className:`px-4 py-2 rounded ${t===s?"bg-green-700 text-white":"bg-white border"}`,children:s==="class"?"Class (Group)":s==="category"?"Category (Sub‑Group)":"Type"},s))}),e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsxs("button",{onClick:W,className:"inline-flex items-center gap-2 bg-green-700 text-white px-4 py-2 rounded hover:bg-green-600",children:[e.jsx(te,{className:"h-5 w-5"})," Add New"]}),e.jsx("input",{className:"w-96 border rounded px-3 py-2",placeholder:"Search…",value:E,onChange:s=>G(s.target.value)}),e.jsxs("select",{className:"border rounded px-2 py-2",value:f,onChange:s=>z(s.target.value),children:[e.jsx("option",{value:"code",children:"Sort: Code"}),e.jsx("option",{value:"name",children:"Sort: Name"}),e.jsx("option",{value:"recent",children:"Sort: Recent"}),e.jsx("option",{value:"sort",children:"Sort: Manual"})]}),t!=="class"&&e.jsxs("select",{className:"border rounded px-2 py-2",value:n?.id??"",onChange:async s=>{const a=Number(s.target.value||0),r=N.find(c=>c.id===a)||null;I(r),A(null)},children:[e.jsx("option",{value:"",children:"Select Class…"}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.class_code," • ",s.class_name]},s.id))]}),t==="type"&&e.jsxs("select",{className:"border rounded px-2 py-2",value:j?.id??"",onChange:s=>{const a=Number(s.target.value||0),r=v.find(c=>c.id===a)||null;A(r)},children:[e.jsx("option",{value:"",children:"Select Category…"}),v.filter(s=>!n||s.class_id===n.id).map(s=>e.jsxs("option",{value:s.id,children:[s.cat_code," • ",s.cat_name]},s.id))]})]}),L&&e.jsx("div",{className:"flex justify-center my-6",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),!L&&e.jsx("div",{className:"border bg-white rounded shadow",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsxs("thead",{className:"bg-gray-100 text-gray-600",children:[t==="class"&&e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"#"}),e.jsx("th",{className:"p-2",children:"Code"}),e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Life"}),e.jsx("th",{className:"p-2",children:"Method"}),e.jsx("th",{className:"p-2",children:"Residual%"}),e.jsx("th",{className:"p-2",children:"Active"}),e.jsx("th",{className:"p-2 w-24 text-center",children:"Actions"})]}),t==="category"&&e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"#"}),e.jsx("th",{className:"p-2",children:"Class"}),e.jsx("th",{className:"p-2",children:"Code"}),e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Active"}),e.jsx("th",{className:"p-2 w-24 text-center",children:"Actions"})]}),t==="type"&&e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"#"}),e.jsx("th",{className:"p-2",children:"Category"}),e.jsx("th",{className:"p-2",children:"Code"}),e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Life⚑"}),e.jsx("th",{className:"p-2",children:"Method⚑"}),e.jsx("th",{className:"p-2",children:"Residual⚑"}),e.jsx("th",{className:"p-2",children:"Active"}),e.jsx("th",{className:"p-2 w-28 text-center",children:"Actions"})]})]}),e.jsxs("tbody",{children:[M.map((s,a)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"p-2",children:(d-1)*w+a+1}),t==="class"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"p-2",children:s.class_code}),e.jsx("td",{className:"p-2",children:s.class_name}),e.jsx("td",{className:"p-2",children:s.default_life_months}),e.jsx("td",{className:"p-2",children:F.find(r=>r.value===s.default_depr_method)?.label}),e.jsx("td",{className:"p-2",children:s.residual_rate}),e.jsx("td",{className:"p-2",children:s.is_active?"Yes":"No"})]}),t==="category"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"p-2",children:N.find(r=>r.id===s.class_id)?.class_code}),e.jsx("td",{className:"p-2",children:s.cat_code}),e.jsx("td",{className:"p-2",children:s.cat_name}),e.jsx("td",{className:"p-2",children:s.is_active?"Yes":"No"})]}),t==="type"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"p-2",children:v.find(r=>r.id===s.category_id)?.cat_code}),e.jsx("td",{className:"p-2",children:s.type_code}),e.jsx("td",{className:"p-2",children:s.type_name}),e.jsx("td",{className:"p-2",children:s.life_months_override??"—"}),e.jsx("td",{className:"p-2",children:s.depr_method_override?F.find(r=>r.value===s.depr_method_override)?.label:"—"}),e.jsx("td",{className:"p-2",children:s.residual_rate_override??"—"}),e.jsx("td",{className:"p-2",children:s.is_active?"Yes":"No"})]}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800",onClick:()=>Z(s),title:"Edit",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>se(s.id),title:"Delete",children:e.jsx(re,{className:"h-5 w-5"})})]})})]},s.id)),M.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-4 text-center text-gray-500",colSpan:9,children:"No records found"})})]})]})}),e.jsxs("div",{className:"flex justify-between mt-4 text-sm text-gray-700",children:[e.jsx("button",{onClick:()=>h(1),disabled:d===1,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"First"}),e.jsx("button",{onClick:()=>h(d-1),disabled:d===1,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"self-center",children:["Page ",d," of ",S]}),e.jsx("button",{onClick:()=>h(d+1),disabled:d===S,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"Next"}),e.jsx("button",{onClick:()=>h(S),disabled:d===S,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"Last"})]}),V&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:k}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl w-full max-w-4xl mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:b==="edit"?t==="class"?"Edit Class":t==="category"?"Edit Category":"Edit Type":t==="class"?"Add Class":t==="category"?"Add Category":"Add Type"}),e.jsx("button",{onClick:k,className:"p-1 rounded hover:bg-gray-100",children:e.jsx(ae,{className:"h-6 w-6 text-gray-600"})})]}),e.jsxs("form",{onSubmit:ee,className:"p-6 grid grid-cols-12 gap-4",children:[t==="class"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Class Code"}),e.jsx("input",{value:x.class_code||"",onChange:s=>u(a=>({...a,class_code:s.target.value.toUpperCase().slice(0,5)})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:5})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Class Name"}),e.jsx("input",{value:x.class_name||"",onChange:s=>u(a=>({...a,class_name:s.target.value})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:150})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Life (mo)"}),e.jsx("input",{type:"number",min:1,value:x.default_life_months??60,onChange:s=>u(a=>({...a,default_life_months:+s.target.value})),className:"w-full border rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Method"}),e.jsx("select",{value:x.default_depr_method||"straight_line",onChange:s=>u(a=>({...a,default_depr_method:s.target.value})),className:"w-full border rounded px-3 py-2",required:!0,children:F.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Residual %"}),e.jsx("input",{type:"number",min:0,max:100,step:.01,value:x.residual_rate??0,onChange:s=>u(a=>({...a,residual_rate:+s.target.value})),className:"w-full border rounded px-3 py-2",required:!0})]}),e.jsx("div",{className:"col-span-2 flex items-end gap-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!x.is_active,onChange:s=>u(a=>({...a,is_active:s.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Active"})]})})]}),t==="category"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Class"}),e.jsxs("select",{value:_.class_id??n?.id??"",onChange:s=>y(a=>({...a,class_id:+s.target.value})),className:"w-full border rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Class…"}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.class_code," • ",s.class_name]},s.id))]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Category Code"}),e.jsx("input",{value:_.cat_code||"",onChange:s=>y(a=>({...a,cat_code:s.target.value.toUpperCase().slice(0,5)})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:5})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Category Name"}),e.jsx("input",{value:_.cat_name||"",onChange:s=>y(a=>({...a,cat_name:s.target.value})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:150})]}),e.jsx("div",{className:"col-span-2 flex items-end gap-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!_.is_active,onChange:s=>y(a=>({...a,is_active:s.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Active"})]})})]}),t==="type"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Category"}),e.jsxs("select",{value:o.category_id??j?.id??"",onChange:s=>m(a=>({...a,category_id:+s.target.value})),className:"w-full border rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Category…"}),v.filter(s=>!n||s.class_id===n.id).map(s=>e.jsxs("option",{value:s.id,children:[s.cat_code," • ",s.cat_name]},s.id))]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Type Code"}),e.jsx("input",{value:o.type_code||"",onChange:s=>m(a=>({...a,type_code:s.target.value.toUpperCase().slice(0,5)})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:5})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Type Name"}),e.jsx("input",{value:o.type_name||"",onChange:s=>m(a=>({...a,type_name:s.target.value})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:150})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Life Override (mo)"}),e.jsx("input",{type:"number",min:1,value:o.life_months_override??"",onChange:s=>m(a=>({...a,life_months_override:s.target.value?+s.target.value:void 0})),className:"w-full border rounded px-3 py-2",placeholder:"inherit"})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Method Override"}),e.jsxs("select",{value:o.depr_method_override??"",onChange:s=>m(a=>({...a,depr_method_override:s.target.value||void 0})),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"inherit"}),F.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Residual % Override"}),e.jsx("input",{type:"number",min:0,max:100,step:.01,value:o.residual_rate_override??"",onChange:s=>m(a=>({...a,residual_rate_override:s.target.value?+s.target.value:void 0})),className:"w-full border rounded px-3 py-2",placeholder:"inherit"})]}),e.jsx("div",{className:"col-span-2 flex items-end gap-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!o.is_active,onChange:s=>m(a=>({...a,is_active:s.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Active"})]})}),b==="edit"&&o.category_id&&e.jsx("div",{className:"col-span-12 text-sm text-gray-600",children:e.jsx("button",{type:"button",className:"underline",onClick:async()=>{const s=p,a=await i.get(`/assets/types/${s}/next-code`);alert(`Next code: ${a.data.code}`)},children:"Preview next asset code"})})]}),e.jsxs("div",{className:"col-span-12 flex justify-end gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:k,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-700 text-white rounded hover:bg-green-600",children:b==="edit"?"Update":"Submit"})]})]})]})]})]})}export{oe as default};
