import{n as j,j as l}from"./index-B6NKXQWy.js";import{r as a}from"./handsontable-DB04mlRq.js";import"./react-DJG_os-6.js";function R({placeholder:w,fetchUrl:S,selectedLabel:u,onChange:_}){const[r,s]=a.useState(!1),[n,c]=a.useState(""),[m,v]=a.useState([]),[d,p]=a.useState(!1),o=a.useRef(null),f=a.useRef(null),g=a.useRef(null);a.useEffect(()=>{const t=i=>{g.current?.contains(i.target)||s(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),a.useEffect(()=>{r&&(c(u||""),requestAnimationFrame(()=>{const t=f.current;t&&(t.focus(),t.selectionStart=t.selectionEnd=t.value.length)}))},[r,u]),a.useEffect(()=>{if(r)return o.current&&clearTimeout(o.current),o.current=setTimeout(E,200),()=>{o.current&&clearTimeout(o.current)}},[r,n]);async function E(){p(!0);try{const t=await j.get(S,{params:{q:n,search:n,term:n}}),$=(Array.isArray(t.data?.data)?t.data.data:Array.isArray(t.data)?t.data:[]).map(e=>"value"in e&&"label"in e?{id:e.id,value:String(e.value),label:String(e.label)}:"class_code"in e?{id:e.id,value:String(e.class_code),label:`${e.class_code} — ${e.class_name??""}`.trim()}:"cat_code"in e?{id:e.id,value:String(e.cat_code),label:`${e.cat_code} — ${e.cat_name??""}`.trim()}:"type_code"in e?{id:e.id,value:String(e.type_code),label:`${e.type_code} — ${e.type_name??""}`.trim()}:"vendor_code"in e?{id:e.id,value:String(e.vendor_code),label:e.vendor_name??e.vendor_code}:{id:e.id,value:String(e.value??e.code??e.id??""),label:String(e.label??e.name??e.title??e.value??"")}),h=new Set;v($.filter(e=>{const y=`${e.value}::${e.label}`;return h.has(y)?!1:(h.add(y),!0)}))}catch{v([])}finally{p(!1)}}const b=!r||!n.trim()?m:m.filter(t=>{const i=n.toLowerCase();return t.label.toLowerCase().includes(i)||t.value.toLowerCase().includes(i)});return l.jsxs("div",{className:"relative",ref:g,children:[l.jsx("input",{ref:f,value:r?n:u||"",onFocus:()=>s(!0),onClick:()=>s(!0),onChange:t=>c(t.target.value),onKeyDown:t=>{t.key==="Escape"&&(t.preventDefault(),s(!1))},onBlur:()=>setTimeout(()=>s(!1),120),placeholder:w||"Search…",className:"w-full border rounded px-3 py-2"}),r&&l.jsxs("div",{className:"absolute z-10 mt-1 w-full max-h-60 overflow-auto bg-white border rounded shadow",children:[d&&l.jsx("div",{className:"p-2 text-sm text-gray-600",children:"Loading…"}),!d&&b.length===0&&l.jsx("div",{className:"p-2 text-sm text-gray-600",children:"No results"}),!d&&b.map(t=>l.jsx("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer",onMouseDown:()=>{_(t),c(t.label),s(!1),requestAnimationFrame(()=>f.current?.focus())},children:t.label},`${t.value}`))]})]})}export{R as default};
