import{j as e,n as m}from"./index-Dq4xTsPt.js";import{r as a}from"./handsontable-DB04mlRq.js";import"./react-DJG_os-6.js";function U(){const[n,c]=a.useState({asset_number:"",description:"",group_name:"",department:"",location:"",custodian:""}),[o,j]=a.useState(20),[h,p]=a.useState(1),[f,E]=a.useState([]),[T,G]=a.useState(0);async function b(){const s=await m.get("/inv/issuance-return",{params:{...n,per:o,page:h}});E(s.data.data??s.data),G(s.data.total??s.data.length??0)}a.useEffect(()=>{b()},[JSON.stringify(n),o,h]);const[t,x]=a.useState(null),[u,g]=a.useState(!0),[N,y]=a.useState(""),[v,C]=a.useState(""),[k,w]=a.useState(""),[I,_]=a.useState(""),[A,B]=a.useState(""),[D,R]=a.useState("");async function q(s){g(!0),y(""),C(""),w(""),_(""),B(""),x({kind:"assign",assetId:s.asset_id,assetNumber:s.asset_number,description:s.description})}async function P(s){g(!0),y(""),x({kind:"return",assetId:s.asset_id,assetNumber:s.asset_number,description:s.description})}async function $(s){R(""),x({kind:"sn",assetId:s.asset_id,assetNumber:s.asset_number,description:s.description})}async function L(){if(t){if(t.kind==="assign"){const s={by_batch:u,department:v,location:k,custodian:I,issued_by:A};u||(s.seq_id=N),await m.post(`/inv/issuance/${t.assetId}`,s)}else if(t.kind==="return"){const s={by_batch:u};u||(s.seq_id=N),await m.post(`/inv/return/${t.assetId}`,s)}else await m.post(`/inv/serials/${t.assetId}`,{start_serial:D});x(null),b()}}return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"bg-yellow-300 rounded border p-2 font-bold",children:"ASSET ISSUANCE"}),e.jsxs("div",{className:"rounded border bg-green-800 p-3 text-white",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-2 items-end",children:[e.jsx(i,{label:"Asset Number",children:e.jsx(l,{value:n.asset_number,onChange:s=>c(d=>({...d,asset_number:s}))})}),e.jsx(i,{label:"Asset Desc",children:e.jsx(l,{value:n.description,onChange:s=>c(d=>({...d,description:s}))})}),e.jsx(i,{label:"Group Asset Name",children:e.jsx(l,{value:n.group_name,onChange:s=>c(d=>({...d,group_name:s}))})}),e.jsx(i,{label:"Department",children:e.jsx(l,{value:n.department,onChange:s=>c(d=>({...d,department:s}))})}),e.jsx(i,{label:"Location",children:e.jsx(l,{value:n.location,onChange:s=>c(d=>({...d,location:s}))})}),e.jsx(i,{label:"Custodian",children:e.jsx(l,{value:n.custodian,onChange:s=>c(d=>({...d,custodian:s}))})})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded bg-white text-green-800",onClick:()=>{p(1),b()},children:"Search"}),e.jsxs("select",{className:"rounded text-black px-2 py-1",value:o,onChange:s=>j(+s.target.value),children:[e.jsx("option",{children:"20"}),e.jsx("option",{children:"50"}),e.jsx("option",{children:"100"})]})]})]}),e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-green-800 text-white",children:e.jsxs("tr",{children:[e.jsx(r,{children:"ASSGN"}),e.jsx(r,{children:"RETURN"}),e.jsx(r,{children:"ASSGN–SN"}),e.jsx(r,{children:"Asset Number"}),e.jsx(r,{children:"Seq ID"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Group Name"}),e.jsx(r,{children:"Group Of"}),e.jsx(r,{children:"Date Purchased"}),e.jsx(r,{children:"Custodian"}),e.jsx(r,{children:"Issued By"})]})}),e.jsx("tbody",{children:f.map(s=>e.jsxs("tr",{className:"odd:bg-white even:bg-green-50",children:[e.jsx(S,{children:e.jsx("button",{className:`px-2 py-1 rounded ${s.status==="IN_STOCK"?"bg-yellow-300":"bg-gray-300 cursor-not-allowed"}`,disabled:s.status!=="IN_STOCK",onClick:()=>q(s),title:"Assign",children:"📦"})}),e.jsx(S,{children:e.jsx("button",{className:`px-2 py-1 rounded ${s.status==="ASSIGNED"?"bg-yellow-300":"bg-gray-300 cursor-not-allowed"}`,disabled:s.status!=="ASSIGNED",onClick:()=>P(s),title:"Return",children:"↩️"})}),e.jsx(S,{children:e.jsx("button",{className:"px-2 py-1 rounded bg-yellow-300",onClick:()=>$(s),title:"Assign Serials",children:"🧾"})})]},s.custody_id))})]})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{className:"px-2 py-1 border rounded",disabled:h<=1,onClick:()=>p(s=>s-1),children:"Prev"}),e.jsxs("span",{children:["Page ",h]}),e.jsx("button",{className:"px-2 py-1 border rounded",disabled:f.length<o,onClick:()=>p(s=>s+1),children:"Next"}),e.jsxs("span",{className:"text-gray-500",children:["Total ~",T]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-yellow-50 rounded-xl border shadow-xl p-4 w-[720px]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"font-bold",children:[t.kind==="assign"&&"Assign Values",t.kind==="return"&&"Return",t.kind==="sn"&&"Assign Serial Numbers"]}),e.jsx("button",{className:"px-2 py-1 bg-white rounded",onClick:()=>x(null),children:"Close this Form"})]}),e.jsxs("div",{className:"mt-2 text-green-800",children:["Asset Number: ",e.jsx("b",{children:t.assetNumber}),"    Asset Description: ",e.jsx("b",{children:t.description})]}),t.kind!=="sn"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:s=>g(s.target.checked)}),e.jsx("span",{children:"Check if By Batch, unCheck if By Individual"})]})}),!u&&e.jsx("div",{className:"mt-2",children:e.jsx(i,{label:"Seq ID",children:e.jsx(l,{value:N,onChange:s=>y(s?+s:"")})})})]}):null,t.kind==="assign"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx(i,{label:"Department",children:e.jsx(l,{value:v,onChange:C})}),e.jsx(i,{label:"Location",children:e.jsx(l,{value:k,onChange:w})}),e.jsx(i,{label:"Custodian",children:e.jsx(l,{value:I,onChange:_})}),e.jsx(i,{label:"Issued By",children:e.jsx(l,{value:A,onChange:B})})]}),t.kind==="sn"&&e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-3",children:e.jsx(i,{label:"Starting Serial Number",children:e.jsx(l,{value:D,onChange:R,placeholder:"e.g., ABC0000"})})}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"px-4 py-2 rounded bg-green-700 text-white",onClick:L,children:t.kind==="assign"?"Assign Values":t.kind==="return"?"Return":"Assign Serials"})})]})})]})}function i({label:n,children:c}){return e.jsxs("label",{className:"text-sm w-full",children:[e.jsxs("div",{className:"mb-1 font-semibold text-white",children:[n,":"]}),c]})}function l({value:n,onChange:c,placeholder:o}){return e.jsx("input",{className:"w-full rounded px-2 py-1 bg-yellow-100 text-black",value:n??"",placeholder:o,onChange:j=>c(j.target.value)})}function r({children:n}){return e.jsx("th",{className:"p-2 text-left",children:n})}function S({children:n}){return e.jsx("td",{className:"p-2",children:n})}export{U as default};
