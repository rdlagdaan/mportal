import{j as e,n as l}from"./index-SwmRNGSt.js";import{r as t}from"./handsontable-DB04mlRq.js";import"./react-DJG_os-6.js";function P(){const[c,x]=t.useState(""),[o,m]=t.useState(20),[u,C]=t.useState(1),[g,j]=t.useState([]),[_,N]=t.useState(0),[a,b]=t.useState(null),[v,y]=t.useState([]),[n,r]=t.useState({});async function p(){const s=await l.get("/inv/gatepass",{params:{q:c,per:o,page:u}});j(s.data.data??s.data),N(s.data.total??s.data.length??0)}t.useEffect(()=>{p()},[c,o,u]);async function w(){if(!n.gatepass_no)return alert("Gatepass # required");const s=await l.post("/inv/gatepass",n);await p(),i(s.data.id)}async function i(s){const d=await l.get(`/inv/gatepass/${s}`);b(d.data.header),y(d.data.items)}async function f(){a&&(await l.post(`/inv/gatepass/${a.id}/items`,{description:"Misc item",qty:1}),i(a.id))}async function S(s){a&&(await l.delete(`/inv/gatepass/items/${s}`),i(a.id))}async function h(s){a&&(await l.post(`/inv/gatepass/${a.id}/${s.toLowerCase()}`),i(a.id),p())}return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"bg-yellow-300 rounded border p-2 font-bold",children:"Gatepass"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border rounded px-2 py-1 bg-yellow-100",placeholder:"Search no/purpose/requester",value:c,onChange:s=>x(s.target.value)}),e.jsxs("select",{className:"border rounded px-2",value:o,onChange:s=>m(+s.target.value),children:[e.jsx("option",{children:"20"}),e.jsx("option",{children:"50"})]}),e.jsx("button",{className:"px-3 py-1 rounded bg-yellow-300",onClick:()=>r({gatepass_no:"",purpose:"",requested_by:""}),children:"New Gatepass"})]}),n.gatepass_no!==void 0&&e.jsxs("div",{className:"bg-yellow-50 border rounded p-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Gatepass #",value:n.gatepass_no||"",onChange:s=>r(d=>({...d,gatepass_no:s.target.value}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Purpose",value:n.purpose||"",onChange:s=>r(d=>({...d,purpose:s.target.value}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Requested By",value:n.requested_by||"",onChange:s=>r(d=>({...d,requested_by:s.target.value}))})]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{className:"px-4 py-1 rounded bg-green-700 text-white",onClick:w,children:"Save"}),e.jsx("button",{className:"px-3 py-1 rounded bg-white border",onClick:()=>r({}),children:"Close"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"border rounded overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-green-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Gatepass #"}),e.jsx("th",{className:"p-2",children:"Status"}),e.jsx("th",{className:"p-2",children:"Purpose"})]})}),e.jsx("tbody",{children:g.map(s=>e.jsxs("tr",{className:`cursor-pointer ${a?.id===s.id?"bg-yellow-100":"odd:bg-white even:bg-green-50"}`,onClick:()=>i(s.id),children:[e.jsx("td",{className:"p-2",children:s.gatepass_no}),e.jsx("td",{className:"p-2",children:s.status}),e.jsx("td",{className:"p-2",children:s.purpose})]},s.id))})]})}),e.jsx("div",{className:"border rounded p-3",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-semibold",children:["#",a.gatepass_no," â€” ",a.status]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 rounded bg-yellow-300",onClick:f,disabled:a.status!=="OPEN",children:"Add Item"}),e.jsx("button",{className:"px-3 py-1 rounded bg-white border",onClick:()=>h("SUBMITTED"),disabled:a.status!=="OPEN",children:"Submit"}),e.jsx("button",{className:"px-3 py-1 rounded bg-green-700 text-white",onClick:()=>h("CLOSED"),disabled:a.status!=="SUBMITTED",children:"Close"})]}),e.jsx("div",{className:"mt-3 overflow-auto border rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-green-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Actions"}),e.jsx("th",{className:"p-2",children:"Asset #"}),e.jsx("th",{className:"p-2",children:"Seq"}),e.jsx("th",{className:"p-2",children:"Description"}),e.jsx("th",{className:"p-2",children:"Qty"})]})}),e.jsx("tbody",{children:v.map(s=>e.jsxs("tr",{className:"odd:bg-white even:bg-green-50",children:[e.jsx("td",{className:"p-2",children:e.jsx("button",{className:"text-red-700",onClick:()=>S(s.id),disabled:a.status!=="OPEN",children:"Delete"})}),e.jsx("td",{className:"p-2",children:s.asset_number||""}),e.jsx("td",{className:"p-2",children:s.seq_id||""}),e.jsx("td",{className:"p-2",children:s.description||""}),e.jsx("td",{className:"p-2",children:s.qty})]},s.id))})]})})]}):e.jsx("div",{className:"text-gray-500",children:"Select a gatepass."})})]})]})}export{P as default};
