import{j as e,n as p}from"./index-Be6lOsMF.js";import{r as l}from"./handsontable-B9UYrM3w.js";import"./react-DJG_os-6.js";function Y(){const[d,x]=l.useState([]),[o,r]=l.useState(""),[i,u]=l.useState(10),[h,a]=l.useState(1),[t,c]=l.useState(null),[m,N]=l.useState("General");async function j(){const s=await p.get("/assets",{params:{q:o,per:i,page:h}});x(s.data.data??s.data)}l.useEffect(()=>{j()},[o,i,h]);async function g(s){const n=await p.get(`/assets/${s}`);c(n.data)}async function b(){t?.asset&&(await p.patch(`/assets/${t.asset.id}`,t.asset),await g(t.asset.id))}async function v(){const s={asset_number:`TMP${Date.now()}`,description:"New Asset",asset_group_id:1,qty:1,life_months:60,gross_amount:0},n=await p.post("/assets",s);await j(),await g(n.data.id)}return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Search asset number/desc",value:o,onChange:s=>r(s.target.value)}),e.jsxs("select",{className:"border px-2 py-1 rounded",value:i,onChange:s=>u(+s.target.value),children:[e.jsx("option",{children:"10"}),e.jsx("option",{children:"20"}),e.jsx("option",{children:"50"})]}),e.jsx("button",{className:"px-3 py-1 rounded bg-green-700 text-white",onClick:v,children:"New Asset"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-1 border rounded overflow-auto max-h-[70vh]",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-green-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Asset No"}),e.jsx("th",{className:"p-2 text-left",children:"Desc"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{onClick:()=>g(s.id),className:`cursor-pointer ${t?.asset?.id===s.id?"bg-yellow-100":"odd:bg-white even:bg-green-50"}`,children:[e.jsx("td",{className:"p-2",children:s.asset_number}),e.jsx("td",{className:"p-2",children:s.description})]},s.id))})]})}),e.jsx("div",{className:"col-span-2 border rounded p-3",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 bg-yellow-50 p-3 rounded mb-3",children:[e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Description",value:t.asset.description??"",onChange:s=>c(n=>({...n,asset:{...n.asset,description:s.target.value}}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Asset Number",disabled:!0,value:t.asset.asset_number}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Quantity",type:"number",min:.01,value:t.asset.qty??1,onChange:s=>c(n=>({...n,asset:{...n.asset,qty:+s.target.value}}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Life (months)",type:"number",min:1,value:t.asset.life_months??60,onChange:s=>c(n=>({...n,asset:{...n.asset,life_months:+s.target.value}}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Purchased Date (YYYY-MM-DD)",value:t.asset.purchased_date??"",onChange:s=>c(n=>({...n,asset:{...n.asset,purchased_date:s.target.value}}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Gross Amount",type:"number",min:0,value:t.asset.gross_amount??0,onChange:s=>c(n=>({...n,asset:{...n.asset,gross_amount:+s.target.value}}))}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!t.asset.vat_inclusive,onChange:s=>c(n=>({...n,asset:{...n.asset,vat_inclusive:s.target.checked}}))}),"VAT Inclusive"]}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"VAT %",value:t.asset.vat_rate??"",onChange:s=>c(n=>({...n,asset:{...n.asset,vat_rate:+s.target.value}}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Supplier",value:t.asset.supplier_name??"",onChange:s=>c(n=>({...n,asset:{...n.asset,supplier_name:s.target.value}}))})]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[["General","Finance","Service","Notes","History","Picture"].map(s=>e.jsx("button",{className:`px-3 py-1 rounded ${m===s?"bg-green-700 text-white":"bg-green-100"}`,onClick:()=>N(s),children:s},s)),e.jsx("div",{className:"ml-auto",children:e.jsx("button",{onClick:b,className:"px-4 py-1 rounded bg-green-700 text-white",children:"Save and Close"})})]}),m==="Service"&&e.jsx(y,{assetId:t.asset.id}),m==="Notes"&&e.jsx(f,{assetId:t.asset.id}),m==="History"&&e.jsx(w,{assetId:t.asset.id}),m==="Picture"&&e.jsx(_,{assetId:t.asset.id}),(m==="General"||m==="Finance")&&e.jsx("div",{className:"text-gray-600",children:"Edit header fields above. (You can split to stricter General/Finance forms later.)"})]}):e.jsx("div",{className:"text-gray-500",children:"Select an asset from the list or click “New Asset”."})})]})]})}function y({assetId:d}){const[x,o]=l.useState([]),[r,i]=l.useState({service_date:""});async function u(){const a=await p.get(`/assets/${d}/service`);o(a.data.data??a.data)}l.useEffect(()=>{u()},[d]);async function h(){await p.post(`/assets/${d}/service`,r),i({service_date:""}),u()}return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-5 gap-2 mb-3",children:[e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Service Date (YYYY-MM-DD)",value:r.service_date||"",onChange:a=>i(t=>({...t,service_date:a.target.value}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Description",value:r.description||"",onChange:a=>i(t=>({...t,description:a.target.value}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Parts Cost",type:"number",value:r.parts_cost||"",onChange:a=>i(t=>({...t,parts_cost:+a.target.value}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Labor Cost",type:"number",value:r.labor_cost||"",onChange:a=>i(t=>({...t,labor_cost:+a.target.value}))}),e.jsx("input",{className:"border px-2 py-1 rounded",placeholder:"Next Due (YYYY-MM-DD)",value:r.next_due_date||"",onChange:a=>i(t=>({...t,next_due_date:a.target.value}))})]}),e.jsx("button",{className:"px-3 py-1 rounded bg-green-700 text-white mb-3",onClick:h,children:"New Service Entry"}),e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-green-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Service Date"}),e.jsx("th",{className:"p-2",children:"Description"}),e.jsx("th",{className:"p-2",children:"Parts Cost"}),e.jsx("th",{className:"p-2",children:"Labor Cost"}),e.jsx("th",{className:"p-2",children:"Next Due Date"})]})}),e.jsx("tbody",{children:x.map(a=>e.jsxs("tr",{className:"odd:bg-white even:bg-green-50",children:[e.jsx("td",{className:"p-2",children:a.service_date}),e.jsx("td",{className:"p-2",children:a.description}),e.jsx("td",{className:"p-2",children:a.parts_cost}),e.jsx("td",{className:"p-2",children:a.labor_cost}),e.jsx("td",{className:"p-2",children:a.next_due_date})]},a.id))})]})})]})}function f({assetId:d}){const[x,o]=l.useState([]),[r,i]=l.useState("");async function u(){const a=await p.get(`/assets/${d}/notes`);o(a.data.data??a.data)}l.useEffect(()=>{u()},[d]);async function h(){r.trim()&&(await p.post(`/assets/${d}/notes`,{note_text:r}),i(""),u())}return e.jsxs("div",{children:[e.jsx("textarea",{className:"w-full border rounded p-2 mb-2",rows:4,placeholder:"Add note...",value:r,onChange:a=>i(a.target.value)}),e.jsx("button",{className:"px-3 py-1 rounded bg-green-700 text-white mb-3",onClick:h,children:"Save Note"}),e.jsx("ul",{className:"space-y-2",children:x.map(a=>e.jsx("li",{className:"border rounded p-2 bg-green-50",children:a.note_text},a.id))})]})}function w({assetId:d}){const[x,o]=l.useState([]);return l.useEffect(()=>{(async()=>{const r=await p.get(`/assets/${d}/history`);o(r.data.data??r.data)})()},[d]),e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-green-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"Time Stamp"}),e.jsx("th",{className:"p-2",children:"Description"}),e.jsx("th",{className:"p-2",children:"Comments"}),e.jsx("th",{className:"p-2",children:"User"}),e.jsx("th",{className:"p-2",children:"Computer"})]})}),e.jsx("tbody",{children:x.map(r=>e.jsxs("tr",{className:"odd:bg-white even:bg-green-50",children:[e.jsx("td",{className:"p-2",children:r.timestamp_at}),e.jsx("td",{className:"p-2",children:r.description}),e.jsx("td",{className:"p-2",children:r.comments}),e.jsx("td",{className:"p-2",children:r.user_name}),e.jsx("td",{className:"p-2",children:r.computer_name})]},r.id))})]})})}function _({assetId:d}){const[x,o]=l.useState([]),[r,i]=l.useState(""),[u,h]=l.useState("");async function a(){const c=await p.get(`/assets/${d}/picture`);o(c.data.data??c.data)}l.useEffect(()=>{a()},[d]);async function t(){r&&(await p.post(`/assets/${d}/picture`,{url:r,caption:u}),i(""),h(""),a())}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{className:"border px-2 py-1 rounded flex-1",placeholder:"Image URL",value:r,onChange:c=>i(c.target.value)}),e.jsx("input",{className:"border px-2 py-1 rounded flex-1",placeholder:"Caption",value:u,onChange:c=>h(c.target.value)}),e.jsx("button",{className:"px-3 py-1 rounded bg-green-700 text-white",onClick:t,children:"Upload"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:x.map(c=>e.jsxs("figure",{className:"border rounded p-2",children:[e.jsx("img",{src:c.url,alt:c.caption||"asset",className:"w-full h-40 object-cover rounded"}),e.jsx("figcaption",{className:"text-xs mt-1",children:c.caption})]},c.id))})]})}export{Y as default};
