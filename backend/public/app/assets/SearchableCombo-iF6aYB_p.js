import{n as D,j as u}from"./index-B04WbdRd.js";import{r as n}from"./handsontable-DB04mlRq.js";import"./react-DJG_os-6.js";function C({placeholder:_,fetchUrl:$,selectedLabel:A,onChange:M}){const[r,o]=n.useState(!1),[s,h]=n.useState(""),[f,g]=n.useState([]),[m,b]=n.useState(!1),[d,l]=n.useState(0),c=n.useRef(null),v=n.useRef(null),i=n.useMemo(()=>{if(!r||!s.trim())return f;const t=s.toLowerCase();return f.filter(a=>a.label.toLowerCase().includes(t)||a.value.toLowerCase().includes(t))},[r,s,f]);n.useEffect(()=>{d>Math.max(i.length-1,0)&&l(0)},[i.length,d]),n.useEffect(()=>{r&&p()},[r]),n.useEffect(()=>{if(r)return c.current&&clearTimeout(c.current),c.current=setTimeout(()=>void p(),200),()=>{c.current&&clearTimeout(c.current)}},[s,r]);async function p(){b(!0);try{const t=await D.get($,{params:{q:s,search:s,term:s}}),j=(Array.isArray(t.data?.data)?t.data.data:Array.isArray(t.data)?t.data:[]).map(e=>"value"in e&&"label"in e?{id:e.id,value:String(e.value),label:String(e.label)}:"class_code"in e?{id:e.id,value:String(e.class_code),label:`${e.class_code} — ${e.class_name??""}`.trim()}:"cat_code"in e?{id:e.id,value:String(e.cat_code),label:`${e.cat_code} — ${e.cat_name??""}`.trim()}:"type_code"in e?{id:e.id,value:String(e.type_code),label:`${e.type_code} — ${e.type_name??""}`.trim()}:"vendor_code"in e?{id:e.id,value:String(e.vendor_code),label:e.vendor_name??e.vendor_code}:{id:e.id,value:String(e.value??e.code??e.id??""),label:String(e.label??e.name??e.title??e.value??"")}),w=new Set;g(j.filter(e=>{const S=`${e.value}::${e.label}`;return w.has(S)?!1:(w.add(S),!0)}))}catch{g([])}finally{b(!1)}}function y(t){M(t),h(""),o(!1),requestAnimationFrame(()=>v.current?.focus())}return u.jsxs("div",{className:"relative z-30",children:[u.jsx("input",{ref:v,onMouseDown:t=>{t.preventDefault(),o(!0),l(0),p(),requestAnimationFrame(()=>v.current?.focus())},value:r?s:A||"",onChange:t=>{h(t.target.value),l(0)},onBlur:()=>setTimeout(()=>o(!1),120),onKeyDown:t=>{if(t.key==="ArrowDown"){if(t.preventDefault(),!r){o(!0),l(0);return}l(a=>Math.min(a+1,Math.max(i.length-1,0)))}else if(t.key==="ArrowUp"){if(t.preventDefault(),!r){o(!0),l(Math.max(i.length-1,0));return}l(a=>Math.max(a-1,0))}else if(t.key==="Enter"){if(r){t.preventDefault();const a=i[d];a&&y(a)}}else t.key==="Escape"&&o(!1)},placeholder:_||"Search…",className:"w-full border rounded px-3 py-2"}),r&&u.jsxs("div",{className:"absolute z-50 mt-1 w-full max-h-60 overflow-auto bg-white border rounded shadow",children:[m&&u.jsx("div",{className:"p-2 text-sm text-gray-600",children:"Loading…"}),!m&&i.length===0&&u.jsx("div",{className:"p-2 text-sm text-gray-600",children:"No results"}),!m&&i.map((t,a)=>u.jsx("div",{className:`px-3 py-2 cursor-pointer ${a===d?"bg-emerald-50 font-semibold":"hover:bg-gray-100"}`,onMouseEnter:()=>l(a),onMouseDown:()=>y(t),children:t.label},`${t.value}`))]})]})}export{C as default};
