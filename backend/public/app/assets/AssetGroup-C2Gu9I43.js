import{n as h,j as e,F as $,a as y}from"./index-Bjh6UvW2.js";import{r as s}from"./handsontable-B9UYrM3w.js";import{F as I,a as U,b as z,g as k}from"./csrf-CCvYirfH.js";import"./react-DJG_os-6.js";const R=[{value:"straight_line",label:"Straight Line"},{value:"declining_balance",label:"Declining Balance"},{value:"units_of_production",label:"Units of Production"},{value:"none",label:"None"}];function J(){const[f,E]=s.useState([]),[v,_]=s.useState(!1),[o,F]=s.useState(10),[r,P]=s.useState(1),[x,A]=s.useState(1),[u,T]=s.useState(""),[g,O]=s.useState(""),[c,D]=s.useState("group_code"),m=s.useRef(null),[G,N]=s.useState(!1),[j,w]=s.useState("add"),[S,C]=s.useState(null),[l,d]=s.useState({group_code:"",group_name:"",name:"",default_life_months:60,default_depr_method:"straight_line",residual_rate:0,is_active:!0,sort_order:0});s.useEffect(()=>{(async()=>{try{const t=await h.get("/api/settings/paginaterecs"),n=Number(t.data?.value)||10;F(n),await i(1,n,g,c)}catch{await i(1,10,g,c)}})()},[]),s.useEffect(()=>(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>O(u),300),()=>{m.current&&clearTimeout(m.current)}),[u]),s.useEffect(()=>{i(1,o,g,c)},[g,c]);async function i(a=1,t=o,n="",K=c){_(!0);try{const p=await h.get("/api/assets/groups",{params:{per_page:t,page:a,q:n,order:K,active_only:!1}});E(p.data.data),A(p.data.last_page),P(p.data.current_page)}catch(p){console.error("Failed to load asset groups",p)}finally{_(!1)}}function L(){w("add"),C(null),d({group_code:"",group_name:"",name:"",default_life_months:60,default_depr_method:"straight_line",residual_rate:0,is_active:!0,sort_order:0}),N(!0)}function X(a){w("edit"),C(a.id),d({...a}),N(!0)}function b(){N(!1)}async function q(a){a.preventDefault(),await k();const t=["group_code","group_name","name","default_life_months","default_depr_method","residual_rate"];for(const n of t)if(l[n]===void 0||l[n]===null||l[n]===""){alert("Please complete all fields.");return}try{j==="edit"&&S?(await h.patch(`/api/assets/groups/${S}`,l,{headers:{"X-XSRF-TOKEN":y.get("XSRF-TOKEN")||""},withCredentials:!0}),alert("Asset group updated")):(await h.post("/api/assets/groups",l,{headers:{"X-XSRF-TOKEN":y.get("XSRF-TOKEN")||""},withCredentials:!0}),alert("Asset group added")),b(),await i(r,o,u,c)}catch(n){alert(n?.response?.data?.message||"Error saving asset group")}}async function M(a){if(confirm("Delete this asset group?")){await k();try{await h.delete(`/api/assets/groups/${a}`,{headers:{"X-XSRF-TOKEN":y.get("XSRF-TOKEN")||""},withCredentials:!0}),alert("Deleted");const t=f.length===1&&r>1?r-1:r;await i(t,o,u,c)}catch{alert("Delete failed")}}}return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-full",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsxs("button",{onClick:L,className:"inline-flex items-center gap-2 bg-green-700 text-white px-4 py-2 rounded hover:bg-green-600",children:[e.jsx(I,{className:"h-5 w-5"}),"Add New Asset Group"]}),e.jsx("input",{type:"text",value:u,onChange:a=>T(a.target.value),placeholder:"Search code, group name, or nameâ€¦",className:"w-96 border rounded px-3 py-2 text-gray-800"}),e.jsxs("select",{value:c,onChange:a=>D(a.target.value),className:"border rounded px-2 py-2 text-gray-800",title:"Sort",children:[e.jsx("option",{value:"group_code",children:"Sort: Code"}),e.jsx("option",{value:"group_name",children:"Sort: Group Name"}),e.jsx("option",{value:"name",children:"Sort: Name"}),e.jsx("option",{value:"recent",children:"Sort: Recent"}),e.jsx("option",{value:"sort",children:"Sort: Manual"})]})]}),v&&e.jsx("div",{className:"flex justify-center my-6",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),!v&&e.jsx("div",{className:"border bg-white rounded shadow",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"#"}),e.jsx("th",{className:"p-2",children:"Group Code"}),e.jsx("th",{className:"p-2",children:"Group Name"}),e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Life (mo)"}),e.jsx("th",{className:"p-2",children:"Method"}),e.jsx("th",{className:"p-2",children:"Residual %"}),e.jsx("th",{className:"p-2",children:"Active"}),e.jsx("th",{className:"p-2 w-24 text-center",children:"Actions"})]})}),e.jsxs("tbody",{children:[f.map((a,t)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"p-2",children:(r-1)*o+t+1}),e.jsx("td",{className:"p-2",children:a.group_code}),e.jsx("td",{className:"p-2",children:a.group_name}),e.jsx("td",{className:"p-2",children:a.name}),e.jsx("td",{className:"p-2",children:a.default_life_months}),e.jsx("td",{className:"p-2",children:R.find(n=>n.value===a.default_depr_method)?.label}),e.jsx("td",{className:"p-2",children:a.residual_rate}),e.jsx("td",{className:"p-2",children:a.is_active?"Yes":"No"}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>X(a),className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx(U,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>M(a.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(z,{className:"h-5 w-5"})})]})})]},a.id)),f.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-4 text-center text-gray-500",colSpan:9,children:"No records found"})})]})]})}),e.jsxs("div",{className:"flex justify-between mt-4 text-sm text-gray-700",children:[e.jsx("button",{onClick:()=>i(1),disabled:r===1,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"First"}),e.jsx("button",{onClick:()=>i(r-1),disabled:r===1,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"self-center",children:["Page ",r," of ",x]}),e.jsx("button",{onClick:()=>i(r+1),disabled:r===x,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"Next"}),e.jsx("button",{onClick:()=>i(x),disabled:r===x,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"Last"})]}),G&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:b}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl w-full max-w-4xl mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:j==="edit"?"Update Asset Group":"Add New Asset Group"}),e.jsx("button",{onClick:b,className:"p-1 rounded hover:bg-gray-100",children:e.jsx($,{className:"h-6 w-6 text-gray-600"})})]}),e.jsxs("form",{onSubmit:q,className:"p-6 grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Group Code"}),e.jsx("input",{type:"text",value:l.group_code??"",onChange:a=>d(t=>({...t,group_code:a.target.value})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:50})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Group Name"}),e.jsx("input",{type:"text",value:l.group_name??"",onChange:a=>d(t=>({...t,group_name:a.target.value})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:150})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Name (Asset Name)"}),e.jsx("input",{type:"text",value:l.name??"",onChange:a=>d(t=>({...t,name:a.target.value})),className:"w-full border rounded px-3 py-2",required:!0,maxLength:150})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Life (months)"}),e.jsx("input",{type:"number",min:1,value:l.default_life_months??60,onChange:a=>d(t=>({...t,default_life_months:Number(a.target.value)})),className:"w-full border rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Depreciation Method"}),e.jsx("select",{value:l.default_depr_method??"straight_line",onChange:a=>d(t=>({...t,default_depr_method:a.target.value})),className:"w-full border rounded px-3 py-2",required:!0,children:R.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Residual (%)"}),e.jsx("input",{type:"number",min:0,max:100,step:.01,value:l.residual_rate??0,onChange:a=>d(t=>({...t,residual_rate:Number(a.target.value)})),className:"w-full border rounded px-3 py-2",required:!0})]}),e.jsx("div",{className:"col-span-2 flex items-end gap-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!l.is_active,onChange:a=>d(t=>({...t,is_active:a.target.checked})),className:"h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Active"})]})}),e.jsxs("div",{className:"col-span-12 flex justify-end gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-700 text-white rounded hover:bg-green-600",children:j==="edit"?"Update":"Submit"})]})]})]})]})]})}export{J as default};
